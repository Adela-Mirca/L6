package webserver;

import java.net.*;
import java.io.*;

public class Webserver extends Thread {
	protected Socket clientSocket;

//	public static void main(String[] args) throws IOException {
//		ServerSocket serverSocket = null;
//
//		try {
//			serverSocket = new ServerSocket(10008);
//			System.out.println("Connection Socket Created");
//			try {
//				while (true) {
//					System.out.println("Waiting for Connection");
//					new Webserver(serverSocket.accept());
//				}
//			} catch (IOException e) {
//				System.err.println("Accept failed.");
//				System.exit(1);
//			}
//		} catch (IOException e) {
//			System.err.println("Could not listen on port: 10008.");
//			System.exit(1);
//		} finally {
//			try {
//				serverSocket.close();
//			} catch (IOException e) {
//				System.err.println("Could not close port: 10008.");
//				System.exit(1);
//			}
//		}
//	}

	public Webserver(Socket clientSoc) {
		clientSocket = clientSoc;
		start();
	}

	public void run() {
		System.out.println("New Communication Thread Started");

		try {
			PrintWriter out = new PrintWriter(clientSocket.getOutputStream(),
					true);
			BufferedReader in = new BufferedReader(new InputStreamReader(
					clientSocket.getInputStream()));

			String inputLine;
			
			while ((inputLine = in.readLine()) != null) {
				System.out.println("Server: " + inputLine);
//				out.println(inputLine);

				if (inputLine.trim().equals(""))
					break;
			}
			out.println("HTTP/1.1 200 OK\r\n"
					+ "Date: Mon, 23 May 2005 22:38:34 GMT\r\n"
					+ "Content-Type: text/html; charset=UTF-8\r\n"
					+ "Content-Length: 155\r\n"
					+ "Last-Modified: Wed, 08 Jan 2003 23:11:55 GMT\r\n"
					+ "Server: Apache/1.3.3.7 (Unix) (Red-Hat/Linux)\r\n"
					+ "ETag: \"3f80f-1b6-3e1cb03b\"\r\n"
					+ "Accept-Ranges: bytes\r\n"
					+ "Connection: close\r\n"
					+ "\r\n"
					+ "<html>\r\n"
					+ "  <head>\r\n"
					+ "    <title>An Example Page</title>\r\n"
					+ "  </head>\r\n"
					+ "  <body>\r\n"
					+ "    <p>Hello World, this is a very simple HTML document.</p>\r\n"
					+ "  </body>\r\n"
					+ "</html>");
			out.close();
			in.close();
			clientSocket.close();
		} catch (IOException e) {
			System.err.println("Problem with Communication Server");
			System.exit(1);
		}
	}
}